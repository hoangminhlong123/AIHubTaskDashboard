@using Microsoft.AspNetCore.Http
@{
    var fullName = Context.Session.GetString("FullName");
    var authToken = Context.Session.GetString("AuthToken");

    if (string.IsNullOrEmpty(fullName) && string.IsNullOrEmpty(authToken))
    {
        var currentPath = Context.Request.Path.Value?.ToLower() ?? "";
        if (!currentPath.Contains("/account/login") && !currentPath.Contains("/account/register"))
        {
            Context.Response.Redirect("/Account/Login");
        }
    }
}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - AIHub Task Tracker</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="~/css/lux_layout.css" />
</head>
<body class="la-body">

    @if (!string.IsNullOrEmpty(fullName))
    {
        <div class="la-wrapper">
            <!-- Sidebar -->
            <aside class="la-sidebar" id="laSidebar">
                <div class="la-sidebar-brand">
                    <div class="la-brand-icon">
                        <i class="bi bi-lightning-charge-fill"></i>
                    </div>
                    <span class="la-brand-text">AIHub OS</span>
                </div>

                <nav class="la-nav">
                    <a href="/" class="la-nav-item" data-page="dashboard">
                        <div class="la-nav-icon"><i class="bi bi-speedometer2"></i></div>
                        <span class="la-nav-text">Dashboard</span>
                        <div class="la-nav-indicator"></div>
                    </a>
                    <a href="/Tasks" class="la-nav-item" data-page="tasks">
                        <div class="la-nav-icon"><i class="bi bi-list-task"></i></div>
                        <span class="la-nav-text">Quản lý Tasks</span>
                        <div class="la-nav-indicator"></div>
                    </a>
                    <a href="/KPI" class="la-nav-item" data-page="kpi">
                        <div class="la-nav-icon"><i class="bi bi-graph-up-arrow"></i></div>
                        <span class="la-nav-text">KPI Hub</span>
                        <div class="la-nav-indicator"></div>
                    </a>
                    <a href="/Account/Profile" class="la-nav-item" data-page="profile">
                        <div class="la-nav-icon"><i class="bi bi-person"></i></div>
                        <span class="la-nav-text">Hồ sơ cá nhân</span>
                        <div class="la-nav-indicator"></div>
                    </a>
                    <a href="/Settings" class="la-nav-item" data-page="settings">
                        <div class="la-nav-icon"><i class="bi bi-gear"></i></div>
                        <span class="la-nav-text">Cài đặt</span>
                        <div class="la-nav-indicator"></div>
                    </a>
                </nav>

                <div class="la-sidebar-footer">
                    <div class="la-sidebar-version">
                        <i class="bi bi-star-fill"></i>
                        <span>Version 2.0</span>
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <div class="la-content">
                <!-- Header -->
                <header class="la-header">
                    <button class="la-toggle-btn" id="sidebarToggle">
                        <i class="bi bi-list"></i>
                    </button>

                    <div class="la-header-actions">
                        <button class="la-action-btn">
                            <i class="bi bi-bell"></i>
                            <span class="la-badge">3</span>
                        </button>

                        <div class="la-divider"></div>

                        <div class="la-dropdown-container">
                            <button class="la-user-btn" id="userDropdownBtn">
                                <div class="la-user-avatar">
                                    @fullName.Substring(0, 1).ToUpper()
                                </div>
                                <div class="la-user-info">
                                    <div class="la-user-name">@fullName</div>
                                    <div class="la-user-role">Administrator</div>
                                </div>
                                <i class="bi bi-chevron-down"></i>
                            </button>
                            <div class="la-dropdown-menu" id="userDropdownMenu">
                                <a href="/Account/Profile" class="la-dropdown-item">
                                    <i class="bi bi-person"></i>
                                    <span>Hồ sơ cá nhân</span>
                                </a>
                                <a href="/Settings" class="la-dropdown-item">
                                    <i class="bi bi-gear"></i>
                                    <span>Cài đặt</span>
                                </a>
                                <div class="la-dropdown-divider"></div>
                                <a href="/Account/Logout" class="la-dropdown-item la-logout">
                                    <i class="bi bi-box-arrow-right"></i>
                                    <span>Đăng xuất</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Main Body -->
                <main class="la-main">
                    @RenderBody()
                </main>

                <!-- Footer -->
                <footer class="la-footer">
                    <div class="la-footer-content">
                        <span>© 2025 AIHub OS. All rights reserved.</span>
                        <div class="la-footer-links">
                            <a href="#">Privacy</a>
                            <span>•</span>
                            <a href="#">Terms</a>
                            <span>•</span>
                            <a href="#">Support</a>
                        </div>
                    </div>
                </footer>
            </div>
        </div>

        <script>
            // Toggle Sidebar
            const sidebarToggle = document.getElementById('sidebarToggle');
            const wrapper = document.querySelector('.la-wrapper');

            sidebarToggle.addEventListener('click', function() {
                wrapper.classList.toggle('la-sidebar-collapsed');
            });

            // Dropdown Menu
            const userDropdownBtn = document.getElementById('userDropdownBtn');
            const userDropdownMenu = document.getElementById('userDropdownMenu');

            userDropdownBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                userDropdownMenu.classList.toggle('show');
            });

            document.addEventListener('click', function(e) {
                if (!e.target.closest('.la-dropdown-container')) {
                    userDropdownMenu.classList.remove('show');
                }
            });

            // Active Nav Highlight
            const navItems = document.querySelectorAll('.la-nav-item');
            const currentPath = window.location.pathname.toLowerCase();

            navItems.forEach(item => {
                const href = item.getAttribute('href').toLowerCase();

                // Remove all active classes first
                item.classList.remove('active');

                // Add active class based on current path
                if (currentPath === '/' && href === '/') {
                    item.classList.add('active');
                } else if (currentPath !== '/' && currentPath.startsWith(href) && href !== '/') {
                    item.classList.add('active');
                }
            });
        </script>
        @RenderSection("Scripts", required: false)
    }
    else
    {
        @RenderBody()
    }
</body>
</html>